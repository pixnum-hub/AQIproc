<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AQI Pro Max</title>

<style>
:root{
  --bg1:#74ebd5;
  --bg2:#9face6;
  --glass:rgba(255,255,255,0.18);
  --border:rgba(255,255,255,0.4);
  --text:#111;
  --sub:#333;
  --accent:#2563eb;
}

/* üåô DARK MODE */
body.dark{
  --glass:rgba(20,20,20,0.75);
  --border:#222;
  --text:#ffffff;
  --sub:#cccccc;
  --accent:#3b82f6;
  background:#0f172a;
}

/* üñ§ AMOLED MODE */
body.amoled{
  --glass:#000000;
  --border:#111;
  --text:#ffffff;
  --sub:#aaaaaa;
  --accent:#3b82f6;
  background:#000000;
}

/* ‚òÄÔ∏è LIGHT MODE */
body.light{
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
}

*{box-sizing:border-box;}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:14px;
  color:var(--text);
  transition:background 0.4s ease;
}

.app{
  width:100%;
  max-width:430px;
  backdrop-filter:blur(20px);
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:24px;
  padding:22px 18px 18px;
  box-shadow:0 20px 45px rgba(0,0,0,0.18);
  text-align:center;
  position:relative;
}

.theme-btn{
  position:absolute;
  top:12px;
  right:12px;
  width:42px;
  height:42px;
  border-radius:50%;
  border:none;
  background:var(--accent);
  color:white;
  font-size:18px;
  cursor:pointer;
}

h1{font-size:1.6rem;margin-bottom:14px;}

input, button.action{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.4);
  margin-bottom:12px;
  font-size:1.05rem;
}

input{background:rgba(255,255,255,0.3);color:var(--text);}
button.action{background:var(--accent);color:white;border:none;font-weight:700;}

#aqiValue{font-size:3rem;font-weight:800;margin-top:6px;}
#status{font-size:1.2rem;font-weight:700;margin-bottom:6px;}

.pollutants{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:12px;
}

.pollutant{
  padding:12px;
  border-radius:12px;
  background:rgba(255,255,255,0.25);
  font-size:1rem;
  font-weight:600;
}

.section-title{
  margin-top:20px;
  font-weight:800;
  font-size:1.1rem;
}

.scroll-row{
  margin-top:10px;
  display:flex;
  gap:10px;
  overflow-x:auto;
  padding-bottom:6px;
}

.scroll-row::-webkit-scrollbar{height:6px;}
.scroll-row::-webkit-scrollbar-thumb{background:var(--accent);border-radius:6px;}

.aqi-box{
  min-width:70px;
  padding:12px 10px;
  border-radius:12px;
  background:rgba(255,255,255,0.25);
  font-size:1.1rem;
  font-weight:800;
  flex-shrink:0;
}

.footer{margin-top:18px;font-size:0.8rem;color:var(--sub);}
</style>
</head>
<body class="light">

<div class="app">
  <button class="theme-btn" onclick="cycleTheme()" id="themeIcon">‚òÄÔ∏è</button>
  <h1>Air Quality Index</h1>

  <input type="text" id="locationInput" placeholder="Enter city or lat,lon">
  <button class="action" onclick="checkAQI()">Check AQI</button>
  <button class="action" onclick="getUserLocation()">üìç Use My Location</button>

  <div id="place"></div>
  <div id="aqiValue"></div>
  <div id="status"></div>

  <div class="pollutants" id="pollutants"></div>

  <div class="section-title">Last 24 Hours AQI</div>
  <div class="scroll-row" id="hourlyRow"></div>

  <div class="section-title">7 Day Average AQI</div>
  <div class="scroll-row" id="weeklyRow"></div>

  <div class="footer">
    ¬© Manik Roy <span id="year"></span>. All Rights Reserved.
  </div>
</div>

<script>
document.getElementById("year").textContent=new Date().getFullYear();

/* üåó THEME CYCLER */
const themes=["light","dark","amoled"];
let currentThemeIndex=0;

function applyTheme(theme){
  document.body.classList.remove("light","dark","amoled");
  document.body.classList.add(theme);

  const icon=document.getElementById("themeIcon");
  if(theme==="light") icon.textContent="‚òÄÔ∏è";
  if(theme==="dark") icon.textContent="üåô";
  if(theme==="amoled") icon.textContent="üñ§";
}

function cycleTheme(){
  currentThemeIndex=(currentThemeIndex+1)%themes.length;
  applyTheme(themes[currentThemeIndex]);
}

/* AQI LOGIC */
function getAQIStatus(aqi){
  if(aqi<=50) return ["Good","green"];
  if(aqi<=100) return ["Moderate","#eab308"];
  if(aqi<=150) return ["Unhealthy (Sensitive)","orange"];
  if(aqi<=200) return ["Unhealthy","red"];
  if(aqi<=300) return ["Very Unhealthy","purple"];
  return ["Hazardous","maroon"];
}

async function geocodeCity(city){
  const res=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}`);
  const data=await res.json();
  if(data.results?.length){
    const r=data.results[0];
    return {lat:r.latitude,lon:r.longitude,name:r.name+", "+r.country};
  }
  return null;
}

async function fetchAQI(lat,lon){
  const url=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=us_aqi,pm2_5,pm10,carbon_monoxide,nitrogen_dioxide,ozone,sulphur_dioxide&past_days=7`;
  const res=await fetch(url);
  return res.json();
}

function renderPollutants(data,i){
  document.getElementById("pollutants").innerHTML=`
    <div class="pollutant">PM2.5 ${data.pm2_5[i]}</div>
    <div class="pollutant">PM10 ${data.pm10[i]}</div>
    <div class="pollutant">CO ${data.carbon_monoxide[i]}</div>
    <div class="pollutant">NO‚ÇÇ ${data.nitrogen_dioxide[i]}</div>
    <div class="pollutant">O‚ÇÉ ${data.ozone[i]}</div>
    <div class="pollutant">SO‚ÇÇ ${data.sulphur_dioxide[i]}</div>
  `;
}

function renderHourlyNumbers(values){
  const row=document.getElementById("hourlyRow");
  row.innerHTML="";
  values.slice(-24).forEach(v=>{
    row.innerHTML+=`<div class="aqi-box">${v}</div>`;
  });
}

function renderWeeklyNumbers(times,values){
  const days={};
  times.forEach((t,i)=>{
    const d=t.split("T")[0];
    if(!days[d]) days[d]=[];
    days[d].push(values[i]);
  });

  const labels=Object.keys(days).slice(-7);
  const row=document.getElementById("weeklyRow");
  row.innerHTML="";

  labels.forEach(d=>{
    const avg=Math.round(days[d].reduce((a,b)=>a+b)/days[d].length);
    row.innerHTML+=`<div class="aqi-box">${avg}</div>`;
  });
}

async function checkAQI(lat=null,lon=null,nameOverride=null){
  const input=document.getElementById("locationInput").value.trim();
  const placeEl=document.getElementById("place");
  const aqiEl=document.getElementById("aqiValue");
  const statusEl=document.getElementById("status");

  if(!lat||!lon){
    if(!input) return alert("Enter location or use GPS");
    if(/^-?\d+(\.\d+)?\s*,\s*-?\d+(\.\d+)?$/.test(input)){
      [lat,lon]=input.split(",").map(Number);
      nameOverride=`Coordinates: ${lat}, ${lon}`;
    }else{
      const geo=await geocodeCity(input);
      if(!geo) return placeEl.textContent="Location not found";
      lat=geo.lat; lon=geo.lon; nameOverride=geo.name;
    }
  }

  placeEl.textContent=nameOverride||"Your Location";
  const data=await fetchAQI(lat,lon);
  const i=data.hourly.us_aqi.length-1;
  const latestAQI=data.hourly.us_aqi[i];

  const [status,color]=getAQIStatus(latestAQI);
  aqiEl.textContent=latestAQI;
  aqiEl.style.color=color;
  statusEl.textContent=status;

  renderPollutants(data.hourly,i);
  renderHourlyNumbers(data.hourly.us_aqi);
  renderWeeklyNumbers(data.hourly.time,data.hourly.us_aqi);
}

function getUserLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    checkAQI(pos.coords.latitude,pos.coords.longitude,"Your Location");
  },()=>alert("Location permission denied"));
}
</script>

</body>
</html>
